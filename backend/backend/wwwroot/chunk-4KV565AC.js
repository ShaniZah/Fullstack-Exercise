import{f as pe,g as me,h as ce,i as de,j as ue,k as j,l as fe,m as ge,n as he,r as ve,s as _e,t as xe,u as Ce}from"./chunk-ANJX3GAW.js";import{$ as d,Aa as U,Ba as P,C as f,Ca as T,D as g,Ea as X,Fa as Y,Gb as oe,Hb as re,Nb as ae,Q as l,Qa as D,Ra as I,Rb as le,Sa as Z,Sb as se,Ta as v,U as x,Va as w,X as h,Yb as R,Zb as F,_a as ee,ab as E,bb as te,ca as p,fb as ne,h as $,ia as r,ib as ie,ja as i,ka as C,la as H,mb as N,na as u,o as q,oa as c,u as y,va as Q,wa as a,x as S,xa as b,y as K,ya as M,za as L}from"./chunk-ZWUYHGBN.js";var k=class t{constructor(n){this.http=n}getHealthReasons(){return this.http.get("assets/health_reasons.json")}submitReport(){return this.http.post(`${E.url}/report`,{},{withCredentials:!0})}static \u0275fac=function(e){return new(e||t)(S(w))};static \u0275prov=y({token:t,factory:t.\u0275fac,providedIn:"root"})};function Ie(t,n){if(t&1&&(r(0,"mat-option",6),a(1),i()),t&2){let e=n.$implicit;p("value",e),l(),b(e.name)}}function we(t,n){if(t&1&&(r(0,"mat-option",6),a(1),i()),t&2){let e=n.$implicit;p("value",e),l(),b(e.name)}}function Ee(t,n){if(t&1){let e=H();r(0,"mat-form-field",0)(1,"mat-label"),a(2,"Subcategory"),i(),r(3,"mat-select",1),T("ngModelChange",function(s){f(e);let m=c();return P(m.selectedLevel2,s)||(m.selectedLevel2=s),g(s)}),u("selectionChange",function(){f(e);let s=c();return g(s.onLevel2Change())}),d(4,we,2,2,"mat-option",2),i()()}if(t&2){let e=c();l(3),U("ngModel",e.selectedLevel2),l(),p("ngForOf",e.level2Options)}}function Re(t,n){if(t&1&&(r(0,"mat-option",6),a(1),i()),t&2){let e=n.$implicit;p("value",e),l(),b(e.name)}}function Fe(t,n){if(t&1){let e=H();r(0,"mat-form-field",0)(1,"mat-label"),a(2,"Detail"),i(),r(3,"mat-select",7),T("ngModelChange",function(s){f(e);let m=c();return P(m.selectedLevel3,s)||(m.selectedLevel3=s),g(s)}),d(4,Re,2,2,"mat-option",2),i()()}if(t&2){let e=c();l(3),U("ngModel",e.selectedLevel3),l(),p("ngForOf",e.level3Options)}}function Oe(t,n){if(t&1&&(r(0,"p"),a(1),i()),t&2){let e=c();l(),b(e.message)}}var V=class t{data=[];level1Options=[];level2Options=[];level3Options=[];selectedLevel1=null;selectedLevel2=null;selectedLevel3=null;message="";reportService=K(k);ngOnInit(){this.reportService.getHealthReasons().subscribe({next:n=>{this.data=n.values,this.level1Options=this.data},error:n=>{console.error("Failed to load health_reasons.json:",n)}})}onLevel1Change(){this.selectedLevel2=null,this.selectedLevel3=null,this.level2Options=this.selectedLevel1?.values||[],this.level3Options=[]}onLevel2Change(){this.selectedLevel3=null,this.level3Options=this.selectedLevel2?.values||[]}submitReport(){this.selectedLevel1&&this.selectedLevel2&&(this.level3Options.length===0||this.selectedLevel3)?(this.message="Sending...",this.reportService.submitReport().subscribe({next:n=>{this.message=n.message},error:n=>{console.error("Error submitting report:",n),this.message="An error occurred while sending your report."}})):this.message="Please complete all dropdowns."}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=h({type:t,selectors:[["app-report"]],decls:13,vars:5,consts:[["appearance","outline",1,"full-width"],[3,"ngModelChange","selectionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["class","full-width","appearance","outline",4,"ngIf"],["mat-raised-button","","color","accent",3,"click"],[4,"ngIf"],[3,"value"],[3,"ngModelChange","ngModel"]],template:function(e,o){e&1&&(r(0,"mat-card")(1,"h2"),a(2,"Report Health Issue"),i(),r(3,"mat-form-field",0)(4,"mat-label"),a(5,"Category"),i(),r(6,"mat-select",1),T("ngModelChange",function(m){return P(o.selectedLevel1,m)||(o.selectedLevel1=m),m}),u("selectionChange",function(){return o.onLevel1Change()}),d(7,Ie,2,2,"mat-option",2),i()(),d(8,Ee,5,2,"mat-form-field",3)(9,Fe,5,2,"mat-form-field",3),r(10,"button",4),u("click",function(){return o.submitReport()}),a(11,"Submit"),i(),d(12,Oe,2,1,"p",5),i()),e&2&&(l(6),U("ngModel",o.selectedLevel1),l(),p("ngForOf",o.level1Options),l(),p("ngIf",o.level2Options.length),l(),p("ngIf",o.level3Options.length),l(3),p("ngIf",o.message))},dependencies:[v,D,I,N,ne,ie,re,oe,se,le,ae,_e,ve,he,F,R],encapsulation:2})};var B=class t{constructor(n){this.http=n}uploadFile(n){let e=new FormData;return e.append("file",n),this.http.post(`${E.url}/File/Upload`,e,{withCredentials:!0}).pipe(q(this.handleError))}handleError(n){return n.status===401?$(()=>new Error("Invalid credentials")):$(()=>new Error("An unexpected error occurred"))}static \u0275fac=function(e){return new(e||t)(S(w))};static \u0275prov=y({token:t,factory:t.\u0275fac,providedIn:"root"})};function Le(t,n){if(t&1&&C(0,"mat-progress-bar",6),t&2){let e=c();p("value",e.uploadProgress)}}function Ue(t,n){if(t&1&&(r(0,"div")(1,"h3"),a(2,"Upload Result:"),i(),r(3,"pre"),a(4),X(5,"json"),i()()),t&2){let e=c();l(4),b(Y(5,1,e.uploadResult))}}function Pe(t,n){if(t&1&&(r(0,"div",7),a(1),i()),t&2){let e=c();l(),M(" ",e.error,`
`)}}var W=class t{constructor(n){this.filesService=n}selectedFile=null;uploadProgress=0;uploadResult=null;error="";onFileSelected(n){let e=n.target;if(!e.files?.length)return;let o=e.files[0];if(!o.name.endsWith(".csv")){this.error="Only CSV files are allowed.";return}this.error="",this.selectedFile=o}uploadFile(){this.selectedFile&&(this.uploadProgress=0,this.uploadResult=null,this.error="",this.filesService.uploadFile(this.selectedFile).subscribe({error:n=>{this.error="Upload failed: "+n.message}}))}static \u0275fac=function(e){return new(e||t)(x(B))};static \u0275cmp=h({type:t,selectors:[["app-upload"]],decls:10,vars:5,consts:[["uploadFileInput",""],["type","file","accept",".csv",2,"display","none",3,"change"],["mat-raised-button","","color","primary",3,"click","disabled"],["mode","determinate",3,"value",4,"ngIf"],[4,"ngIf"],["class","error",4,"ngIf"],["mode","determinate",3,"value"],[1,"error"]],template:function(e,o){if(e&1){let s=H();r(0,"div")(1,"input",1,0),u("change",function(_){return f(s),g(o.onFileSelected(_))}),i(),r(3,"button",2),u("click",function(){f(s);let _=Q(2);return g(_.click())}),a(4," Choose File "),i(),r(5,"button",2),u("click",function(){return f(s),g(o.uploadFile())}),a(6," Upload "),i()(),d(7,Le,1,1,"mat-progress-bar",3)(8,Ue,6,3,"div",4)(9,Pe,2,1,"div",5)}e&2&&(l(3),p("disabled",o.selectedFile),l(2),p("disabled",!o.selectedFile),l(2),p("ngIf",o.uploadProgress>0&&o.uploadProgress<100),l(),p("ngIf",o.uploadResult),l(),p("ngIf",o.error))},dependencies:[v,I,Z,N,Ce,xe,F,R],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;padding:2rem}div[_ngcontent-%COMP%]{max-width:600px;width:100%;display:flex;flex-direction:column;gap:1rem}input[type=file][_ngcontent-%COMP%]{border:1px solid #ccc;padding:.5rem;background-color:#fafafa;border-radius:4px;font-size:14px}button[_ngcontent-%COMP%]{align-self:flex-start;font-weight:700}mat-progress-bar[_ngcontent-%COMP%]{height:10px;border-radius:5px}pre[_ngcontent-%COMP%]{background-color:#f4f4f4;padding:1rem;border-radius:6px;max-height:300px;overflow:auto;white-space:pre-wrap}.error[_ngcontent-%COMP%]{color:#d32f2f;font-weight:500}"]})};var A=class t{constructor(n){this.http=n}getUsers(){return this.http.get(`${E.url}/data/GetAll`,{withCredentials:!0})}static \u0275fac=function(e){return new(e||t)(S(w))};static \u0275prov=y({token:t,factory:t.\u0275fac,providedIn:"root"})};function De(t,n){if(t&1&&(r(0,"li"),a(1),i()),t&2){let e=n.$implicit;l(),L(" Minute ",e.minute," - ",e.state," ")}}function Ne(t,n){if(t&1&&(r(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),a(3),i(),r(4,"mat-panel-description"),a(5),i()(),r(6,"div")(7,"p")(8,"b"),a(9,"Height:"),i(),a(10),i(),r(11,"p")(12,"b"),a(13,"Weight:"),i(),a(14),i(),r(15,"p")(16,"b"),a(17,"BMI:"),i(),a(18),i(),r(19,"p")(20,"b"),a(21,"Heart Rate Info:"),i()(),r(22,"ul"),d(23,De,2,2,"li",1),i(),r(24,"p")(25,"b"),a(26,"Average Heart Rate:"),i(),a(27),i()()()),t&2){let e=n.$implicit;l(3),L(" ",e.firstName," ",e.lastName," "),l(2),L(" ID: ",e.id," | Age: ",e.age," "),l(5),M(" ",e.height," cm"),l(4),M(" ",e.weight," kg"),l(4),M(" ",e.bmi,""),l(5),p("ngForOf",e.heartRateStatuses),l(4),M(" ",e.avgHeartRate,"")}}function je(t,n){if(t&1&&(r(0,"mat-accordion"),d(1,Ne,28,9,"mat-expansion-panel",1),i()),t&2){let e=c();l(),p("ngForOf",e.users)}}var z=class t{constructor(n){this.userService=n}users=[];ngOnInit(){this.userService.getUsers().subscribe(n=>{this.users=n.map(e=>{e.bmi=this.calculateBMI(e.height,e.weight);let{avg:o,states:s}=this.analyzeHeartRate(e.heartRate);return e.avgHeartRate=o,e.heartRateStatuses=this.extractFirstMinuteOfStates(s),e})})}calculateBMI(n,e){let o=n/100;return+(e/(o*o)).toFixed(2)}analyzeHeartRate(n){let e=n.split(";").map(Number),o=[];return e.forEach((m,_)=>{let G="awake";m<70?G="sleeping":m>=90&&(G="workout"),o.push({minute:_+1,state:G})}),{avg:+(e.reduce((m,_)=>m+_,0)/e.length).toFixed(2),states:o}}extractFirstMinuteOfStates(n){let e=[],o=null;for(let s of n)s.state!==o&&(e.push(s),o=s.state);return e}static \u0275fac=function(e){return new(e||t)(x(A))};static \u0275cmp=h({type:t,selectors:[["app-user-data"]],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(e,o){e&1&&d(0,je,2,1,"mat-accordion",0),e&2&&p("ngIf",o.users.length)},dependencies:[v,D,I,j,ue,pe,me,de,ce],encapsulation:2})};var Se=class t{constructor(n,e){this.router=n;this.authService=e}onLogout(){this.authService.logout().subscribe({next:()=>this.router.navigate(["/login"]),error:n=>console.error("Logout failed",n)})}static \u0275fac=function(e){return new(e||t)(x(ee),x(te))};static \u0275cmp=h({type:t,selectors:[["app-dashboard"]],decls:19,vars:0,consts:[["color","primary"],[1,"spacer"],["mat-button","",3,"click"],[1,"dashboard-container"],[1,"section-card"]],template:function(e,o){e&1&&(r(0,"mat-toolbar",0)(1,"span"),a(2,"Dashboard"),i(),C(3,"span",1),r(4,"button",2),u("click",function(){return o.onLogout()}),a(5,"Logout"),i()(),r(6,"div",3)(7,"div",4)(8,"h2"),a(9,"User Information"),i(),C(10,"app-user-data"),i(),r(11,"div",4)(12,"h2"),a(13,"Report Health Issue"),i(),C(14,"app-report"),i(),r(15,"div",4)(16,"h2"),a(17,"Upload CSV File"),i(),C(18,"app-upload"),i()())},dependencies:[v,ge,fe,F,R,j,V,W,z],styles:["mat-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}.report-upload-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:flex-start;justify-content:space-between;gap:2rem;margin-top:2rem;flex-wrap:wrap}.report-upload-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1 1 48%;max-width:48%;box-sizing:border-box}"]})};export{Se as DashboardComponent};
