import{f as me,g as ce,h as de,i as ue,j as fe,k as j,l as ge,m as he,n as ve,r as _e,s as xe,t as Ce,u as be}from"./chunk-OEKXRXHK.js";import{$a as ie,A as f,Aa as D,B as g,Ca as Y,Da as Z,Eb as re,Fb as ae,Lb as le,O as l,Oa as T,Pa as I,Pb as se,Qa as $,Qb as pe,Ra as v,S as x,Ta as w,V as h,Wb as E,Xa as ee,Xb as F,Z as d,Za as te,_a as R,aa as p,db as ne,ga as r,gb as oe,h as q,ha as n,ia as C,ja as H,kb as N,la as u,ma as c,n as K,t as S,ta as X,ua as a,va as b,w as y,wa as M,x as Q,xa as P,ya as L,za as U}from"./chunk-XVC7QZHA.js";var k=class t{constructor(i){this.http=i}getHealthReasons(){return this.http.get("assets/health_reasons.json")}submitReport(){return this.http.post(R.sendReport,{},{withCredentials:!0})}static \u0275fac=function(e){return new(e||t)(y(w))};static \u0275prov=S({token:t,factory:t.\u0275fac,providedIn:"root"})};function we(t,i){if(t&1&&(r(0,"mat-option",6),a(1),n()),t&2){let e=i.$implicit;p("value",e),l(),b(e.name)}}function Re(t,i){if(t&1&&(r(0,"mat-option",6),a(1),n()),t&2){let e=i.$implicit;p("value",e),l(),b(e.name)}}function Ee(t,i){if(t&1){let e=H();r(0,"mat-form-field",0)(1,"mat-label"),a(2,"Subcategory"),n(),r(3,"mat-select",1),D("ngModelChange",function(s){f(e);let m=c();return U(m.selectedLevel2,s)||(m.selectedLevel2=s),g(s)}),u("selectionChange",function(){f(e);let s=c();return g(s.onLevel2Change())}),d(4,Re,2,2,"mat-option",2),n()()}if(t&2){let e=c();l(3),L("ngModel",e.selectedLevel2),l(),p("ngForOf",e.level2Options)}}function Fe(t,i){if(t&1&&(r(0,"mat-option",6),a(1),n()),t&2){let e=i.$implicit;p("value",e),l(),b(e.name)}}function Oe(t,i){if(t&1){let e=H();r(0,"mat-form-field",0)(1,"mat-label"),a(2,"Detail"),n(),r(3,"mat-select",7),D("ngModelChange",function(s){f(e);let m=c();return U(m.selectedLevel3,s)||(m.selectedLevel3=s),g(s)}),d(4,Fe,2,2,"mat-option",2),n()()}if(t&2){let e=c();l(3),L("ngModel",e.selectedLevel3),l(),p("ngForOf",e.level3Options)}}function He(t,i){if(t&1&&(r(0,"p"),a(1),n()),t&2){let e=c();l(),b(e.message)}}var V=class t{data=[];level1Options=[];level2Options=[];level3Options=[];selectedLevel1=null;selectedLevel2=null;selectedLevel3=null;message="";reportService=Q(k);ngOnInit(){this.reportService.getHealthReasons().subscribe({next:i=>{this.data=i.values,this.level1Options=this.data},error:i=>{console.error("Failed to load health_reasons.json:",i)}})}onLevel1Change(){this.selectedLevel2=null,this.selectedLevel3=null,this.level2Options=this.selectedLevel1?.values||[],this.level3Options=[]}onLevel2Change(){this.selectedLevel3=null,this.level3Options=this.selectedLevel2?.values||[]}submitReport(){this.selectedLevel1&&this.selectedLevel2&&(this.level3Options.length===0||this.selectedLevel3)?(this.message="Sending...",this.reportService.submitReport().subscribe({next:i=>{this.message=i.message},error:i=>{console.error("Error submitting report:",i),this.message="An error occurred while sending your report."}})):this.message="Please complete all dropdowns."}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=h({type:t,selectors:[["app-report"]],decls:13,vars:5,consts:[["appearance","outline",1,"full-width"],[3,"ngModelChange","selectionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["class","full-width","appearance","outline",4,"ngIf"],["mat-raised-button","","color","accent",3,"click"],[4,"ngIf"],[3,"value"],[3,"ngModelChange","ngModel"]],template:function(e,o){e&1&&(r(0,"mat-card")(1,"h2"),a(2,"Report Health Issue"),n(),r(3,"mat-form-field",0)(4,"mat-label"),a(5,"Category"),n(),r(6,"mat-select",1),D("ngModelChange",function(m){return U(o.selectedLevel1,m)||(o.selectedLevel1=m),m}),u("selectionChange",function(){return o.onLevel1Change()}),d(7,we,2,2,"mat-option",2),n()(),d(8,Ee,5,2,"mat-form-field",3)(9,Oe,5,2,"mat-form-field",3),r(10,"button",4),u("click",function(){return o.submitReport()}),a(11,"Submit"),n(),d(12,He,2,1,"p",5),n()),e&2&&(l(6),L("ngModel",o.selectedLevel1),l(),p("ngForOf",o.level1Options),l(),p("ngIf",o.level2Options.length),l(),p("ngIf",o.level3Options.length),l(3),p("ngIf",o.message))},dependencies:[v,T,I,N,ne,oe,ae,re,pe,se,le,xe,_e,ve,F,E],encapsulation:2})};var B=class t{constructor(i){this.http=i}uploadFile(i){let e=new FormData;return e.append("file",i),this.http.post(R.uploadFile,e,{withCredentials:!0}).pipe(K(this.handleError))}handleError(i){return i.status===401?q(()=>new Error("Invalid credentials")):q(()=>new Error("An unexpected error occurred"))}static \u0275fac=function(e){return new(e||t)(y(w))};static \u0275prov=S({token:t,factory:t.\u0275fac,providedIn:"root"})};function Le(t,i){if(t&1&&C(0,"mat-progress-bar",6),t&2){let e=c();p("value",e.uploadProgress)}}function Ue(t,i){if(t&1&&(r(0,"div")(1,"h3"),a(2,"Upload Result:"),n(),r(3,"pre"),a(4),Y(5,"json"),n()()),t&2){let e=c();l(4),b(Z(5,1,e.uploadResult))}}function De(t,i){if(t&1&&(r(0,"div",7),a(1),n()),t&2){let e=c();l(),M(" ",e.error,`
`)}}var A=class t{constructor(i){this.filesService=i}selectedFile=null;uploadProgress=0;uploadResult=null;error="";onFileSelected(i){let e=i.target;if(!e.files?.length)return;let o=e.files[0];if(!o.name.endsWith(".csv")){this.error="Only CSV files are allowed.";return}this.error="",this.selectedFile=o}uploadFile(){this.selectedFile&&(this.uploadProgress=0,this.uploadResult=null,this.error="",this.filesService.uploadFile(this.selectedFile).subscribe({error:i=>{this.error="Upload failed: "+i.message}}))}static \u0275fac=function(e){return new(e||t)(x(B))};static \u0275cmp=h({type:t,selectors:[["app-upload"]],decls:12,vars:5,consts:[["uploadFileInput",""],["type","file","accept",".csv",2,"display","none",3,"change"],["mat-raised-button","","color","primary",3,"click","disabled"],["mode","determinate",3,"value",4,"ngIf"],[4,"ngIf"],["class","error",4,"ngIf"],["mode","determinate",3,"value"],[1,"error"]],template:function(e,o){if(e&1){let s=H();r(0,"div")(1,"h2"),a(2,"Upload CSV File"),n(),r(3,"input",1,0),u("change",function(_){return f(s),g(o.onFileSelected(_))}),n(),r(5,"button",2),u("click",function(){f(s);let _=X(4);return g(_.click())}),a(6," Choose File "),n(),r(7,"button",2),u("click",function(){return f(s),g(o.uploadFile())}),a(8," Upload "),n()(),d(9,Le,1,1,"mat-progress-bar",3)(10,Ue,6,3,"div",4)(11,De,2,1,"div",5)}e&2&&(l(5),p("disabled",o.selectedFile),l(2),p("disabled",!o.selectedFile),l(2),p("ngIf",o.uploadProgress>0&&o.uploadProgress<100),l(),p("ngIf",o.uploadResult),l(),p("ngIf",o.error))},dependencies:[v,I,$,N,be,Ce,F,E],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;padding:2rem}div[_ngcontent-%COMP%]{max-width:600px;width:100%;display:flex;flex-direction:column;gap:1rem}input[type=file][_ngcontent-%COMP%]{border:1px solid #ccc;padding:.5rem;background-color:#fafafa;border-radius:4px;font-size:14px}button[_ngcontent-%COMP%]{align-self:flex-start;font-weight:700}mat-progress-bar[_ngcontent-%COMP%]{height:10px;border-radius:5px}pre[_ngcontent-%COMP%]{background-color:#f4f4f4;padding:1rem;border-radius:6px;max-height:300px;overflow:auto;white-space:pre-wrap}.error[_ngcontent-%COMP%]{color:#d32f2f;font-weight:500}"]})};var W=class t{constructor(i){this.http=i}getUsers(){return this.http.get(R.getData,{withCredentials:!0})}static \u0275fac=function(e){return new(e||t)(y(w))};static \u0275prov=S({token:t,factory:t.\u0275fac,providedIn:"root"})};function Ne(t,i){if(t&1&&(r(0,"li"),a(1),n()),t&2){let e=i.$implicit;l(),P(" Minute ",e.minute," - ",e.state," ")}}function je(t,i){if(t&1&&(r(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),a(3),n(),r(4,"mat-panel-description"),a(5),n()(),r(6,"div")(7,"p")(8,"b"),a(9,"Height:"),n(),a(10),n(),r(11,"p")(12,"b"),a(13,"Weight:"),n(),a(14),n(),r(15,"p")(16,"b"),a(17,"BMI:"),n(),a(18),n(),r(19,"p")(20,"b"),a(21,"Heart Rate Info:"),n()(),r(22,"ul"),d(23,Ne,2,2,"li",1),n(),r(24,"p")(25,"b"),a(26,"Average Heart Rate:"),n(),a(27),n()()()),t&2){let e=i.$implicit;l(3),P(" ",e.firstName," ",e.lastName," "),l(2),P(" ID: ",e.id," | Age: ",e.age," "),l(5),M(" ",e.height," cm"),l(4),M(" ",e.weight," kg"),l(4),M(" ",e.bmi,""),l(5),p("ngForOf",e.heartRateStatuses),l(4),M(" ",e.avgHeartRate,"")}}function ke(t,i){if(t&1&&(r(0,"mat-accordion"),d(1,je,28,9,"mat-expansion-panel",1),n()),t&2){let e=c();l(),p("ngForOf",e.users)}}var z=class t{constructor(i){this.userService=i}users=[];ngOnInit(){this.userService.getUsers().subscribe(i=>{this.users=i.map(e=>{e.bmi=this.calculateBMI(e.height,e.weight);let{avg:o,states:s}=this.analyzeHeartRate(e.heartRate);return e.avgHeartRate=o,e.heartRateStatuses=this.extractFirstMinuteOfStates(s),e})})}calculateBMI(i,e){let o=i/100;return+(e/(o*o)).toFixed(2)}analyzeHeartRate(i){let e=i.split(";").map(Number),o=[];return e.forEach((m,_)=>{let J="awake";m<70?J="sleeping":m>=90&&(J="workout"),o.push({minute:_+1,state:J})}),{avg:+(e.reduce((m,_)=>m+_,0)/e.length).toFixed(2),states:o}}extractFirstMinuteOfStates(i){let e=[],o=null;for(let s of i)s.state!==o&&(e.push(s),o=s.state);return e}static \u0275fac=function(e){return new(e||t)(x(W))};static \u0275cmp=h({type:t,selectors:[["app-user-data"]],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(e,o){e&1&&d(0,ke,2,1,"mat-accordion",0),e&2&&p("ngIf",o.users.length)},dependencies:[v,T,I,j,fe,me,ce,ue,de],encapsulation:2})};var Ie=class t{constructor(i,e){this.router=i;this.authService=e}onLogout(){this.authService.logout().subscribe({next:()=>this.router.navigate([`/${te.login}`]),error:i=>console.error("Logout failed",i)})}static \u0275fac=function(e){return new(e||t)(x(ee),x(ie))};static \u0275cmp=h({type:t,selectors:[["app-dashboard"]],decls:15,vars:0,consts:[["color","primary"],[1,"spacer"],["mat-button","",3,"click"],[1,"dashboard-container"],[1,"section-card"]],template:function(e,o){e&1&&(r(0,"mat-toolbar",0)(1,"span"),a(2,"Dashboard"),n(),C(3,"span",1),r(4,"button",2),u("click",function(){return o.onLogout()}),a(5,"Logout"),n()(),r(6,"div",3)(7,"div",4)(8,"h2"),a(9,"User Information"),n(),C(10,"app-user-data"),n(),r(11,"div",4),C(12,"app-report"),n(),r(13,"div",4),C(14,"app-upload"),n()())},dependencies:[v,he,ge,F,E,j,V,A,z],styles:["mat-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}.report-upload-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:flex-start;justify-content:space-between;gap:2rem;margin-top:2rem;flex-wrap:wrap}.report-upload-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1 1 48%;max-width:48%;box-sizing:border-box}"]})};export{Ie as DashboardComponent};
