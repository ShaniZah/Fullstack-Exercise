import{f as ae,g as le,h as se,i as pe,j as me,k as ce,l as de,m as ue,n as fe,r as ge,s as he,t as _e,u as ve}from"./chunk-ANJX3GAW.js";import{$ as d,Aa as P,Ba as T,C as f,Ca as U,D as g,Ea as q,Fa as K,Gb as te,Hb as ie,Nb as ne,Q as a,Qa as D,Ra as M,Rb as oe,Sa as Q,Sb as re,Ta as y,U as I,Va as S,X as C,Yb as w,Zb as R,_a as X,ab as k,bb as Y,ca as p,fb as Z,h as G,ia as r,ib as ee,ja as n,ka as E,la as F,mb as j,na as u,o as $,oa as c,u as b,va as J,wa as l,x,xa as _,y as H,ya as v,za as L}from"./chunk-ZWUYHGBN.js";var N=class t{constructor(i){this.http=i}getUsers(){return this.http.get(`${k.url}/data/GetAll`,{withCredentials:!0})}static \u0275fac=function(e){return new(e||t)(x(S))};static \u0275prov=b({token:t,factory:t.\u0275fac,providedIn:"root"})};var V=class t{constructor(i){this.http=i}getHealthReasons(){return this.http.get("assets/health_reasons.json")}submitReport(){return this.http.post(`${k.url}/report`,{},{withCredentials:!0})}static \u0275fac=function(e){return new(e||t)(x(S))};static \u0275prov=b({token:t,factory:t.\u0275fac,providedIn:"root"})};function Se(t,i){if(t&1&&(r(0,"mat-option",6),l(1),n()),t&2){let e=i.$implicit;p("value",e),a(),_(e.name)}}function we(t,i){if(t&1&&(r(0,"mat-option",6),l(1),n()),t&2){let e=i.$implicit;p("value",e),a(),_(e.name)}}function Re(t,i){if(t&1){let e=F();r(0,"mat-form-field",0)(1,"mat-label"),l(2,"Subcategory"),n(),r(3,"mat-select",1),U("ngModelChange",function(s){f(e);let m=c();return T(m.selectedLevel2,s)||(m.selectedLevel2=s),g(s)}),u("selectionChange",function(){f(e);let s=c();return g(s.onLevel2Change())}),d(4,we,2,2,"mat-option",2),n()()}if(t&2){let e=c();a(3),P("ngModel",e.selectedLevel2),a(),p("ngForOf",e.level2Options)}}function Ie(t,i){if(t&1&&(r(0,"mat-option",6),l(1),n()),t&2){let e=i.$implicit;p("value",e),a(),_(e.name)}}function Ee(t,i){if(t&1){let e=F();r(0,"mat-form-field",0)(1,"mat-label"),l(2,"Detail"),n(),r(3,"mat-select",7),U("ngModelChange",function(s){f(e);let m=c();return T(m.selectedLevel3,s)||(m.selectedLevel3=s),g(s)}),d(4,Ie,2,2,"mat-option",2),n()()}if(t&2){let e=c();a(3),P("ngModel",e.selectedLevel3),a(),p("ngForOf",e.level3Options)}}function Fe(t,i){if(t&1&&(r(0,"p"),l(1),n()),t&2){let e=c();a(),_(e.message)}}var B=class t{data=[];level1Options=[];level2Options=[];level3Options=[];selectedLevel1=null;selectedLevel2=null;selectedLevel3=null;message="";reportService=H(V);ngOnInit(){this.reportService.getHealthReasons().subscribe({next:i=>{this.data=i.values,this.level1Options=this.data},error:i=>{console.error("Failed to load health_reasons.json:",i)}})}onLevel1Change(){this.selectedLevel2=null,this.selectedLevel3=null,this.level2Options=this.selectedLevel1?.values||[],this.level3Options=[]}onLevel2Change(){this.selectedLevel3=null,this.level3Options=this.selectedLevel2?.values||[]}submitReport(){this.selectedLevel1&&this.selectedLevel2&&(this.level3Options.length===0||this.selectedLevel3)?(this.message="Sending...",this.reportService.submitReport().subscribe({next:i=>{this.message=i.message},error:i=>{console.error("Error submitting report:",i),this.message="An error occurred while sending your report."}})):this.message="Please complete all dropdowns."}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=C({type:t,selectors:[["app-report"]],decls:13,vars:5,consts:[["appearance","outline",1,"full-width"],[3,"ngModelChange","selectionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["class","full-width","appearance","outline",4,"ngIf"],["mat-raised-button","","color","accent",3,"click"],[4,"ngIf"],[3,"value"],[3,"ngModelChange","ngModel"]],template:function(e,o){e&1&&(r(0,"mat-card")(1,"h2"),l(2,"Report Health Issue"),n(),r(3,"mat-form-field",0)(4,"mat-label"),l(5,"Category"),n(),r(6,"mat-select",1),U("ngModelChange",function(m){return T(o.selectedLevel1,m)||(o.selectedLevel1=m),m}),u("selectionChange",function(){return o.onLevel1Change()}),d(7,Se,2,2,"mat-option",2),n()(),d(8,Re,5,2,"mat-form-field",3)(9,Ee,5,2,"mat-form-field",3),r(10,"button",4),u("click",function(){return o.submitReport()}),l(11,"Submit"),n(),d(12,Fe,2,1,"p",5),n()),e&2&&(a(6),P("ngModel",o.selectedLevel1),a(),p("ngForOf",o.level1Options),a(),p("ngIf",o.level2Options.length),a(),p("ngIf",o.level3Options.length),a(3),p("ngIf",o.message))},dependencies:[y,D,M,j,Z,ee,ie,te,re,oe,ne,he,ge,fe,R,w],encapsulation:2})};var W=class t{constructor(i){this.http=i}URL="https://localhost:7200";uploadFile(i){let e=new FormData;return e.append("file",i),this.http.post(`${this.URL}/File/Upload`,e,{withCredentials:!0}).pipe($(this.handleError))}handleError(i){return i.status===401?G(()=>new Error("Invalid credentials")):G(()=>new Error("An unexpected error occurred"))}static \u0275fac=function(e){return new(e||t)(x(S))};static \u0275prov=b({token:t,factory:t.\u0275fac,providedIn:"root"})};function He(t,i){if(t&1&&E(0,"mat-progress-bar",6),t&2){let e=c();p("value",e.uploadProgress)}}function Le(t,i){if(t&1&&(r(0,"div")(1,"h3"),l(2,"Upload Result:"),n(),r(3,"pre"),l(4),q(5,"json"),n()()),t&2){let e=c();a(4),_(K(5,1,e.uploadResult))}}function Pe(t,i){if(t&1&&(r(0,"div",7),l(1),n()),t&2){let e=c();a(),v(" ",e.error,`
`)}}var A=class t{constructor(i){this.filesService=i}selectedFile=null;uploadProgress=0;uploadResult=null;error="";onFileSelected(i){let e=i.target;if(!e.files?.length)return;let o=e.files[0];if(!o.name.endsWith(".csv")){this.error="Only CSV files are allowed.";return}this.error="",this.selectedFile=o}uploadFile(){this.selectedFile&&(this.uploadProgress=0,this.uploadResult=null,this.error="",this.filesService.uploadFile(this.selectedFile).subscribe({error:i=>{this.error="Upload failed: "+i.message}}))}static \u0275fac=function(e){return new(e||t)(I(W))};static \u0275cmp=C({type:t,selectors:[["app-upload"]],decls:10,vars:5,consts:[["uploadFileInput",""],["type","file","accept",".csv",2,"display","none",3,"change"],["mat-raised-button","","color","primary",3,"click","disabled"],["mode","determinate",3,"value",4,"ngIf"],[4,"ngIf"],["class","error",4,"ngIf"],["mode","determinate",3,"value"],[1,"error"]],template:function(e,o){if(e&1){let s=F();r(0,"div")(1,"input",1,0),u("change",function(h){return f(s),g(o.onFileSelected(h))}),n(),r(3,"button",2),u("click",function(){f(s);let h=J(2);return g(h.click())}),l(4," Choose File "),n(),r(5,"button",2),u("click",function(){return f(s),g(o.uploadFile())}),l(6," Upload "),n()(),d(7,He,1,1,"mat-progress-bar",3)(8,Le,6,3,"div",4)(9,Pe,2,1,"div",5)}e&2&&(a(3),p("disabled",o.selectedFile),a(2),p("disabled",!o.selectedFile),a(2),p("ngIf",o.uploadProgress>0&&o.uploadProgress<100),a(),p("ngIf",o.uploadResult),a(),p("ngIf",o.error))},dependencies:[y,M,Q,j,ve,_e,R,w],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;padding:2rem}div[_ngcontent-%COMP%]{max-width:600px;width:100%;display:flex;flex-direction:column;gap:1rem}input[type=file][_ngcontent-%COMP%]{border:1px solid #ccc;padding:.5rem;background-color:#fafafa;border-radius:4px;font-size:14px}button[_ngcontent-%COMP%]{align-self:flex-start;font-weight:700}mat-progress-bar[_ngcontent-%COMP%]{height:10px;border-radius:5px}pre[_ngcontent-%COMP%]{background-color:#f4f4f4;padding:1rem;border-radius:6px;max-height:300px;overflow:auto;white-space:pre-wrap}.error[_ngcontent-%COMP%]{color:#d32f2f;font-weight:500}"]})};function Te(t,i){if(t&1&&(r(0,"li"),l(1),n()),t&2){let e=i.$implicit;a(),L("Minute ",e.minute," - ",e.state,"")}}function Ue(t,i){if(t&1&&(r(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),l(3),n(),r(4,"mat-panel-description"),l(5),n()(),r(6,"div")(7,"p")(8,"b"),l(9,"Height:"),n(),l(10),n(),r(11,"p")(12,"b"),l(13,"Weight:"),n(),l(14),n(),r(15,"p")(16,"b"),l(17,"BMI:"),n(),l(18),n(),r(19,"p")(20,"b"),l(21,"Heart Rate Info:"),n()(),r(22,"ul"),d(23,Te,2,2,"li",5),n(),r(24,"p")(25,"b"),l(26,"Average Heart Rate:"),n(),l(27),n()()()),t&2){let e=i.$implicit;a(3),L("",e.firstName," ",e.lastName,""),a(2),L("ID: ",e.id," | Age: ",e.age,""),a(5),v(" ",e.height," cm"),a(4),v(" ",e.weight," kg"),a(4),v(" ",e.bmi,""),a(5),p("ngForOf",e.heartRateStatuses),a(4),v(" ",e.avgHeartRate,"")}}function De(t,i){if(t&1&&(r(0,"mat-accordion"),d(1,Ue,28,9,"mat-expansion-panel",5),n()),t&2){let e=c();a(),p("ngForOf",e.users)}}var ye=class t{constructor(i,e){this.router=i;this.authService=e}users=[];userService=H(N);ngOnInit(){this.userService.getUsers().subscribe(i=>{this.users=i.map(e=>{e.bmi=this.calculateBMI(e.height,e.weight);let{avg:o,states:s}=this.analyzeHeartRate(e.heartRate);return e.avgHeartRate=o,e.heartRateStatuses=this.extractFirstMinuteOfStates(s),e})})}onLogout(){console.log("logging out..."),this.authService.logout().subscribe({next:()=>{this.router.navigate(["/login"])},error:i=>{console.error("Logout failed",i)}})}calculateBMI(i,e){let o=i/100;return+(e/(o*o)).toFixed(2)}analyzeHeartRate(i){let e=i.split(";").map(Number),o=[];return e.forEach((m,h)=>{let z="awake";m<70?z="sleeping":m>=90&&(z="workout"),o.push({minute:h+1,state:z})}),{avg:+(e.reduce((m,h)=>m+h,0)/e.length).toFixed(2),states:o}}extractFirstMinuteOfStates(i){let e=[],o=null;for(let s of i)s.state!==o&&(e.push(s),o=s.state);return e}static \u0275fac=function(e){return new(e||t)(I(X),I(Y))};static \u0275cmp=C({type:t,selectors:[["app-dashboard"]],decls:10,vars:1,consts:[["color","primary"],[1,"spacer"],["mat-button","",3,"click"],[4,"ngIf"],[1,"report-upload-container"],[4,"ngFor","ngForOf"]],template:function(e,o){e&1&&(r(0,"mat-toolbar",0)(1,"span"),l(2,"Dashboard"),n(),E(3,"span",1),r(4,"button",2),u("click",function(){return o.onLogout()}),l(5,"Logout"),n()(),d(6,De,2,1,"mat-accordion",3),r(7,"div",4),E(8,"app-report")(9,"app-upload"),n()),e&2&&(a(6),p("ngIf",o.users.length))},dependencies:[y,D,M,ue,de,R,w,ce,me,ae,le,pe,se,B,A],styles:["mat-toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}.report-upload-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:flex-start;justify-content:space-between;gap:2rem;margin-top:2rem;flex-wrap:wrap}.report-upload-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1 1 48%;max-width:48%;box-sizing:border-box}"]})};export{ye as DashboardComponent};
